---
layout: post
title: '[JavaScript] ECMAScript 2020'
featured-img: javascript/js.png
category: [tech, javaScript]
summary: ES2020에 추가된 기능을 살펴보도록 하겠습니다.
---
{% include toc.html %}

ES2020(ES11)에 추가된 기능들을 살표보도록 하겠습니다.

# `String.prototype.matchAll`
문자열에서 일치하는 정규식을 iterator 형태로 반환하는 함수입니다. 사용방법은 기존 정규식 `match`와 동일합니다.

## `for of` 사용
iterator을 반환하기 때문에 `for of` 문을 사용할 수 있습니다.

```js
const str = '11a22ba';
const result = str.matchAll(/a/g);
for (const item of result) {
  console.log(item)
}
/*
['a', index: 2, input: '11a22ba', groups: undefined]
['a', index: 6, input: '11a22ba', groups: undefined]
*/
```

## 문자열 사용
`matchAll` 함수의 파라미터로 문자열을 전달 할 수도 있습니다.

```js
const str = '11a22ba';
const result = str.matchAll('a');
result.next(); // { value: ['a', index: 2, input: '11a22ba', groups: undefinded], done: false }
result.next(); // { value: ['a', index: 6, input: '11a22ba', groups: undefinded], done: false }
result.next(); // { value: undefined, done: true }
```

## 주의사항
`matchAll` 함수의 파라미터로 정규식을 전달할 경우 글로벌 옵션(`g`)을 줘야 합니다. 글로벌 옵션이 없는 경우 non-global RegExp 에러가 발생합니다.

```js
const str = '11a22ba';
const result = str.matchAll(/a/); // Uncaught TypeError: String.prototype.matchAll called with a non-global RegExp argument
```

# `import()`
동적으로 파일을 가져올 수 있게 하는 `Promise`를 반환하는 함수입니다.

```js
// 📁 say.js
export function hi() {
  alert(`안녕하세요.`);
}

export function bye() {
  alert(`안녕히 가세요.`);
}
```

```js
let {hi, bye} = await import('./say.js');

hi();
bye();
```

# `BigInt`
자바스크립트는 2^53 보다 큰 수를 표현할 수 없습니다. 2^53 보다 큰 수를 표현할 수 있도록 `BigInt`가 추가되었습니다.

```js
const num = Number.MAX_SAFE_INTEGER;
console.log(num); // 9007199254740991
console.log(num + 1); // 9007199254740992
console.log(num + 2); // 9007199254740992

const bigInt = 9007199254740991n; // 또는 BigInt(9007199254740991)
console.log(bigInt); // 9007199254740991
console.log(bigInt + 1n); // 9007199254740992
console.log(bigInt + 2n); // 9007199254740993
```

`typeof 1n`은 `bigint`이기 때문에 때문에 새로운 타입이 생겼다고 볼 수 있습니다. 타입에 차이가 있기 때문에 `1n`과 `1`은 아래와 같이 차이가 있습니다.

```js
typeof 1n; // bigint
1n === 1 // false
1n == 1 // true
```

## `Number`와 유사점
`BigInt` 타입을 사용할 때, `Number` 타입과 유사한 방법으로 사용할 수 있는 연산들을 살펴보겠습니다.

### 크기비교
`1n !== 1`이지만 `Number`와 `BigInt` 사이의 크기비교가 가능합니다.

```js
1n < 2 // true
2n > 1 // true
2 > 2 // false
2n > 2 // false
2n >= 2 // true
```

### 정렬
정렬도 `Number`와 유사합니다.

```js
const mixed = [4n, 6, -12n, 10, 4, 0, 0n];
mixed.sort(); // [-12n, 0, 0n, 10, 4n, 4, 6]
```

### 조건 판단
조건 판단 기준 역시 `Number`와 비슷합니다.

```js
if (0n) {
  console.log('Hello from the if!');
} else {
  console.log('Hello from the else!');
} // "Hello from the else!"

0n || 12n // 12n
0n && 12n // 0n
Boolean(0n) // false
Boolean(12n) // true
!12n // false
!0n // true
```

## 주의사항
`Number` 타입과 동일하게 `BigInt` 타입을 사용할 때 주의해야 할 사항을 살펴보겠습니다.

### `BigInt`와 `Number` 간의 계산
`BigInt`와 `Number`간의 계산은 `TypeError`가 발생합니다.

```js
1n + 2 // TypeError: Cannot mix BigInt and other types, use explicit conversions
1n * 2 // TypeError: Cannot mix BigInt and other types, use explicit conversions
```

### `BigInt`에서 `Number`로 형 변환
`+` 연산을 사용해서 `BigInt`를 `Number`로 형 변환도 불가능합니다. `BigInt`를 `Number`로 형 변환을 하기 위해서는 `Number` 함수를 사용해야 합니다.

```js
+1n // TypeError: Cannot convert a BigInt value to a number
Number(1n) // 1
```

### `Math` 함수와 `|` 연산
`Math` 함수, `Number`와 `|` 연산를 사용할 때 `TypeError`가 발생합니다.

```js
Math.round(1n) // TypeError: Cannot convert a BigInt value to a number
Math.max(1n, 10n) // TypeError: Cannot convert a BigInt value to a number
1n|0 // TypeError: Cannot mix BigInt and other types, use explicit conversions
```

# `Promise.allSettled`

# `globalThis`

# `for-in` mechanics

# Optional Chaining

# Nullish coalescing Operator

# `import.meta`

#### 참고
- [https://github.com/tc39/proposals/blob/master/finished-proposals.md](https://github.com/tc39/proposals/blob/master/finished-proposals.md)
- [https://www.zerocho.com/category/ECMAScript/post/5eae7480e70c21001f3e7956](https://www.zerocho.com/category/ECMAScript/post/5eae7480e70c21001f3e7956)
- [https://github.com/tc39/proposal-string-matchall](https://github.com/tc39/proposal-string-matchall)
- [https://www.npmjs.com/package/string.prototype.matchall](https://www.npmjs.com/package/string.prototype.matchall)
- [https://ko.javascript.info/modules-dynamic-imports](https://ko.javascript.info/modules-dynamic-imports)